const app=new App(appSettings),comparisonSlot=document.querySelector("#settingsSlot");let comparison;if(comparisonSlot){setTimeout(function(){comparison=new Comparison;comparisonSlot.appendChild(comparison.elem)},100)}(function(){const input=document.querySelector("#fileSelector"),label=document.querySelector("[for='fileSelector']");input&&input.addEventListener("change",proceedFiles);label&&label.addEventListener("keypress",function(event){if(event.keyCode!=32&&event.keyCode!=13){return}event.preventDefault();input.click()});window.addEventListener("drop",proceedFiles,true);window.addEventListener("dragover",function(event){const types=Array.prototype.slice.call(event.dataTransfer.types);event.preventDefault();for(let index in types){let type=types[index];if(type.indexOf("text")!=-1){event.dataTransfer.dropEffect="none";return}}event.dataTransfer.dropEffect=app.list.length<appSettings.maxLength?"copy":"none"},true);function proceedFiles(event){if(!app){return}event.preventDefault();let data=event.dataTransfer,target=event.target,files;if(data){files=data.files}else{files=target.files}if(!files){return}files=Array.prototype.slice.call(files);for(let index in files){let file=files[index];app.add(file)}if(!data){event.target.value=""}}})();(function(){const Ajax=function(method,url,options){options=options||{};const METHOD_GET="GET",METHOD_POST="POST";const xhr=new XMLHttpRequest,funcs={},data=options&&Object.assign({},options.data);method=method.toUpperCase();this.timeoutId=-1;this.stopped=false;this.abort=function(){this.stopped=true;clearTimeout(this.timeoutId);xhr.abort()};this.onLoad=setFn.bind(this,"load");this.onFinal=setFn.bind(this,"final");this.onProgress=setFn.bind(this,"progress");this.onAbort=setFn.bind(this,"abort");this.onError=setFn.bind(this,"error");data.rnd=Math.random();if(method==METHOD_GET){url+="?";for(let key in data){url+="&"+key+"="+encodeURIComponent(data[key])}url=url.replace("?&","?")}xhr.addEventListener("load",function(){let response=xhr.response;if(xhr.status!=200){this.stopped=true;runFn("error",xhr.status+": "+xhr.statusText);runFn("final");return}if(!options.type){response=JSON.parse(response)}if(response.status=="error"){clearTimeout(this.timeoutId);this.stopped=true;runFn("error",response.details);runFn("final");return}if(options.progress){if(response[options.progress.key]==100){clearTimeout(this.timeoutId);this.stopped=true;runFn("load",response);runFn("final");return}if(url.split("?")[0]==options.progress.url){if(this.stopped){return}url=options.progress.url+"?rnd="+Math.random();runFn("progress",response[options.progress.key]);this.timeoutId=setTimeout(send,500);return}url=options.progress.url+"?rnd="+Math.random();send();return}runFn("load",response);runFn("final")}.bind(this));xhr.addEventListener("error",function(err){runFn("error",err);runFn("final")});xhr.addEventListener("abort",function(err){runFn(funcs.abort?"abort":"error",err.type);runFn("final")});xhr.upload&&xhr.upload.addEventListener("progress",function(event){runFn("progress",event.loaded/event.total)});send();return;function send(){xhr.open(method,url,true);if(method==METHOD_GET){xhr.send()}else{xhr.send(formatData(data))}}function formatData(){const formData=new FormData;for(let key in data){formData.append(key,data[key])}return formData}function setFn(fnName,fn){if(!funcs[fnName]){funcs[fnName]=[]}funcs[fnName].push(fn);return this}function runFn(fnName){if(!funcs[fnName]){return}for(let index in funcs[fnName]){let fn=funcs[fnName][index];fn.apply(this,Array.prototype.slice.call(arguments,1))}}};window.Ajax=Ajax})();(function(){let templateElem=document.querySelector("#template-popup");if(!templateElem){return}const list=[],template=elemFromStr(templateElem.innerHTML),links=document.querySelectorAll("[data-popup]");if(!links||!links.length){return}templateElem.parentNode.removeChild(templateElem);templateElem=undefined;Array.prototype.forEach.call(links,function(link){link.addEventListener("click",function(event){event.preventDefault();new Popup(this)})});document.addEventListener("click",function(event){if(!list.length||event.target.closest(".popup__overflow")){return}closeAll()});const Popup=function(node){this.elem=null;this.href=node.href;this.title=node.dataset.popup||node.title;this.close=close;new Ajax("GET",this.href,{type:"text"}).onLoad(init.bind(this));function init(response){this.content=response;this.elem=template.cloneNode(true);this.elem.querySelector(".popup__title").innerHTML=this.title;this.elem.querySelector(".popup__content").innerHTML=this.content;this.elem.querySelector(".popup__close").addEventListener("click",function(event){event.preventDefault();this.close()}.bind(this));closeAll();document.body.appendChild(this.elem);setTimeout(function(){this.elem.classList.add("popup_visible");list.push(this)}.bind(this),100)}function close(){if(!this.elem.classList.contains("popup_visible")){remove.call(this);return}this.elem.addEventListener("transitionend",function(event){if(event.target!=this.elem||event.propertyName!="opacity"){return}this.visible=false;remove.call(this)}.bind(this));this.elem.classList.remove("popup_visible")}function remove(){this.elem&&this.elem.parentNode.removeChild(this.elem);for(let key in this){delete this[key]}removeFromList(this)}};function closeAll(){for(let index in list){let popup=list[index];popup.close()}}function removeFromList(popup){for(let index in list){if(popup!=list[index]){continue}list.splice(index,1);break}}function elemFromStr(str){let div=document.createElement("div");div.innerHTML=str;return div.firstElementChild}})();(function(){const language=document.querySelector("#language");if(!language){return}language.addEventListener("change",function(){location.href=(this.value[0]=="/"?"":"/")+this.value})})();(function(){const lifetime=5e3,maxLength=5,list=[],stack=[],template=function(){const elem=document.querySelector("#template-notice"),div=document.createElement("div");if(!elem){return}div.innerHTML=elem.innerHTML;elem.parentNode.removeChild(elem);return div.firstElementChild}();let parent=null;if(!template){return}const Notice=function(text){if(!parent){parent=createParent()}this.elem=template.cloneNode(true);this.elem.firstElementChild.insertAdjacentHTML("afterbegin",text);this.remove=function(){for(let key in this){delete this[key]}};stack.push(this);update()};function update(){while(list.length<maxLength&&stack.length){let item=stack.shift();list.push(item);setTimeout(function(){remove(item.elem)},lifetime)}for(let index in list){let item=list[index];if(parent.contains(item.elem)){continue}if(parent.children.length){parent.insertBefore(item.elem,parent.firstElementChild)}else{parent.appendChild(item.elem)}}requestAnimationFrame(function(){parent.style.transform="translate3d(-50%,"+parent.offsetHeight+"px,0)"})}function remove(elem){for(let index in list){let item=list[index];if(item.elem!=elem){continue}item.remove();list.splice(index,1);elem.addEventListener("transitionend",function(event){if(event.propertyName!="opacity"||event.target!=elem){return}elem.parentNode.removeChild(elem);update()});elem.style.height=elem.offsetHeight+"px";requestAnimationFrame(function(){elem.classList.add("notices__item_hidden")});break}}function createParent(){const ul=document.createElement("ul");ul.classList.add("notices");ul.addEventListener("click",function(event){const target=event.target.closest(".notices__item");if(!target){return}remove(target)});document.body.appendChild(ul);return ul}window.Notice=Notice})();(function(){let elems=document.querySelectorAll("[data-share]");elems=Array.prototype.slice.call(elems);for(let index in elems){let elem=elems[index];let href=elem.getAttribute("href");href=href.replace("{{url}}",encodeURIComponent(appSettings.origin||location.href));href=href.replace("{{text}}",encodeURIComponent(appSettings.title||document.title));elem.setAttribute("href",href)}})();(function(){const copies=[];function SmoothScroll(elem){for(let index in copies){let copy=copies[index];if(copy.elem==elem){return copy}}init.call(this);function init(){this.scrollTo=scrollTo;this.stop=stop;this.tick=tick;this.elem=elem;this.pos={from:null,to:null,dur:null};this.time={start:null,end:null};this.timerId=null;this.duration=null;copies.push(this)}function scrollTo(to,dur,callback){this.stop();let width=this.elem.offsetWidth,maxTo=this.elem.scrollWidth-width;this.pos.from=this.elem.scrollLeft;this.callback=callback;if(to>=maxTo&&maxTo==this.pos.from||to<=0&&!this.pos.from){this.callback&&this.callback();return}this.pos.to=Math.max(0,Math.min(maxTo,to));this.pos.dur=this.pos.to-this.pos.from;if(this.pos.to==to||!this.pos.to||!Number.isFinite(to)){this.duration=dur}else{this.duration=dur*(this.pos.to/to)}this.time.start=performance.now();this.time.end=this.time.start+this.duration;this.tick()}function stop(){cancelAnimationFrame(this.timerId);init.call(this)}function tick(){let currentTime=performance.now();this.time.dur=currentTime-this.time.start,value=easeInOutQuad(this.time.dur,this.pos.from,this.pos.dur,this.duration);this.elem.scrollLeft=value;if(currentTime<this.time.end&&value!=this.pos.to){this.timerId=requestAnimationFrame(tick.bind(this))}else{this.elem.scrollLeft=this.pos.to;this.callback&&this.callback();this.stop()}}function easeInOutQuad(t,b,c,d){t/=d/2;if(t<1)return c/2*t*t+b;t--;return-c/2*(t*(t-2)-1)+b}}window.SmoothScroll=SmoothScroll})();
